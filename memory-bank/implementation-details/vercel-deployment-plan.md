# Vercel Deployment Plan for QC-Diffusion Code Subproject

*Created: 2025-08-23 17:46:03 IST*
*Last Updated: 2025-08-23 18:52:31 IST*

## Overview

This document outlines the deployment strategy for the standalone qc-diffusion-code repository to Vercel, including monorepo configuration, dependency management, and build process optimization.

## Repository Structure

```
qc-diffusion-code/
├── frontend/                    # React + Vite application
│   ├── src/                    # Application source code
│   ├── package.json            # Frontend dependencies
│   ├── pnpm-lock.yaml         # Package lockfile (ISSUE)
│   ├── vite.config.ts         # Vite configuration
│   └── vercel.json            # Vercel deployment config
├── backend/                    # Python FastAPI (not deployed to Vercel)
├── packages/
│   ├── graph-core/            # Local graph core package
│   └── graph-ui/              # Local graph UI package
└── memory-bank/               # Project documentation
```

## Deployment Configuration

### Vercel Settings
- **Framework**: None (manual configuration)
- **Root Directory**: Repository root (not `frontend`)
- **Build Command**: `pnpm --filter qc-diffusion-frontend build`
- **Output Directory**: `frontend/dist`
- **Install Command**: `pnpm install`

### vercel.json Configuration
Located at `frontend/vercel.json`:
```json
{
  "buildCommand": "pnpm install && pnpm build",
  "outputDirectory": "dist",
  "installCommand": "pnpm install",
  "devCommand": "pnpm dev",
  "framework": null,
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ],
  "env": {
    "NODE_ENV": "production"
  }
}
```

## Dependency Management

### Local Package Dependencies
- `@spin-network/graph-core`: `file:../packages/graph-core`
- Eliminates external path dependencies from original spin-network-app project
- Packages copied directly into repository for self-containment

### Package Manager
- Uses pnpm with lockfile version 9 (generated by pnpm@10.x)
- Package manager specified in frontend/package.json: `pnpm@10.14.0+sha512...`

## Deployment Solution

### 1. pnpm Workspace Configuration
**Issue**: Missing dependencies in `packages/graph-core` during TypeScript compilation

**Root Cause**: Lack of proper pnpm workspace configuration, causing dependencies of sub-packages not to be installed

**Solution Implemented**:
```yaml
# pnpm-workspace.yaml (created at repo root)
packages:
  - 'frontend'
  - 'backend'
  - 'packages/*'
```

This workspace configuration enables pnpm to properly resolve dependencies across the monorepo, ensuring that all required packages are installed for both the frontend and local packages.

### 2. Root Package.json Configuration
**Issue**: Missing build script at root level and redundant dependencies

**Solution Implemented**:
```json
// package.json (at repo root)
{
  "name": "qc-diffusion-code",
  "version": "1.0.0",
  "scripts": {
    "build": "pnpm --filter qc-diffusion-frontend build"
  },
  "packageManager": "pnpm@10.14.0"
}
```

This configuration provides a convenient build script at the root level and removes redundant dependencies (graphology, graphology-types) that were previously in the root package.json but not used there.

### 3. Vercel Output Directory Configuration
**Issue**: Vercel expected an output directory named `public`, but Vite's default output directory is `dist`

**Solution Implemented**:
- Verified `frontend/vite.config.ts` uses default output directory `dist`
- Updated Vercel project settings to use `frontend/dist` as the output directory
- This approach aligns Vercel's expectations with Vite's default output without requiring changes to the Vite configuration

## Successful Deployment Implementation

### Phase 1: Monorepo Configuration
1. ✅ Created `pnpm-workspace.yaml` at repo root with packages: frontend, backend, packages/*
2. ✅ Updated root `package.json` with build script and removed redundant dependencies
3. ✅ Verified frontend build script in `frontend/package.json`:
   ```
   cd ../packages/graph-core && pnpm build && cd ../../frontend && tsc -b && vite build
   ```
4. ✅ Confirmed local builds succeed without TypeScript errors after workspace fix

### Phase 2: Vercel Configuration
1. ✅ Set Root Directory to repository root (not `frontend`)
2. ✅ Set Install Command to `pnpm install`
3. ✅ Set Build Command to `pnpm --filter qc-diffusion-frontend build`
4. ✅ Set Output Directory to `frontend/dist`
5. ✅ Deployed and verified successful build process

### Phase 3: Production Testing
1. ✅ Verified frontend loads correctly on Vercel URL
2. ✅ Tested application functionality including particle simulation
3. ✅ Confirmed grid layout persistence works correctly
4. ✅ Validated all UI components render properly

## Production Considerations

### Backend Separation
- Backend (Python FastAPI) cannot deploy to Vercel
- Frontend needs to handle backend unavailability gracefully
- Consider deploying backend to Railway, Render, or DigitalOcean

### Environment Configuration
```typescript
// Production config example
const config = {
  apiUrl: process.env.NODE_ENV === 'production' 
    ? 'https://api-domain.com' 
    : 'http://localhost:8000',
  wsUrl: process.env.NODE_ENV === 'production' 
    ? 'wss://api-domain.com/ws' 
    : 'ws://localhost:8000/ws'
}
```

### Static Asset Optimization
- Vite handles code splitting and asset optimization
- Vercel provides CDN distribution automatically
- Large assets (3D models, datasets) may need external CDN

## Success Metrics

### Deployment Success
- [x] Build completes without errors
- [x] Application loads on Vercel URL
- [x] React components render correctly
- [x] Static assets load properly

### Functionality Verification
- [x] Random walk simulation initializes
- [x] Parameter controls work
- [x] Particle visualizations display
- [x] Grid layout persists
- [x] Distribution controls function

### Performance Targets
- [x] Initial load < 3 seconds
- [x] First Contentful Paint < 1.5 seconds
- [x] Lighthouse score > 90
- [x] Bundle size < 2MB

## Rollback Strategy

If deployment fails:
1. Revert to previous commit
2. Use local development server
3. Debug issues in isolation
4. Re-attempt deployment after fixes

## Deployment Conclusion

The Vercel deployment of the qc-diffusion-code monorepo has been successfully completed with the following key solutions:

1. **pnpm Workspace Configuration**: Added `pnpm-workspace.yaml` at the repository root to enable proper dependency resolution across the monorepo.
2. **Root Package.json Updates**: Added a convenience build script and removed redundant dependencies.
3. **Vercel Project Settings**: Configured to use the repository root as the Root Directory and `frontend/dist` as the Output Directory.
4. **Build Command**: Used `pnpm --filter qc-diffusion-frontend build` to ensure proper package resolution.

These changes resolved the TypeScript compilation errors in `packages/graph-core` and ensured that all dependencies were properly installed during the build process. The application now successfully builds and deploys on Vercel with all functionality working as expected.

## Future Enhancements

1. **Backend Integration**: Deploy backend separately and configure CORS
2. **CI/CD Pipeline**: Automate testing and deployment
3. **Performance Monitoring**: Add analytics and error tracking
4. **Progressive Enhancement**: Offline functionality and service workers
