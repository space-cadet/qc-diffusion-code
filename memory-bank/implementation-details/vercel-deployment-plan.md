# Vercel Deployment Plan for QC-Diffusion Code Subproject

*Created: 2025-08-23 17:46:03 IST*

## Overview

This document outlines the deployment strategy for the standalone qc-diffusion-code repository to Vercel, including monorepo configuration, dependency management, and build process optimization.

## Repository Structure

```
qc-diffusion-code/
├── frontend/                    # React + Vite application
│   ├── src/                    # Application source code
│   ├── package.json            # Frontend dependencies
│   ├── pnpm-lock.yaml         # Package lockfile (ISSUE)
│   ├── vite.config.ts         # Vite configuration
│   └── vercel.json            # Vercel deployment config
├── backend/                    # Python FastAPI (not deployed to Vercel)
├── packages/
│   ├── graph-core/            # Local graph core package
│   └── graph-ui/              # Local graph UI package
└── memory-bank/               # Project documentation
```

## Deployment Configuration

### Vercel Settings
- **Framework**: None (manual configuration)
- **Root Directory**: `frontend` (configured in Vercel dashboard)
- **Build Command**: `pnpm install && pnpm build`
- **Output Directory**: `dist`
- **Install Command**: `pnpm install`

### vercel.json Configuration
Located at `frontend/vercel.json`:
```json
{
  "buildCommand": "pnpm install && pnpm build",
  "outputDirectory": "dist",
  "installCommand": "pnpm install",
  "devCommand": "pnpm dev",
  "framework": null,
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ],
  "env": {
    "NODE_ENV": "production"
  }
}
```

## Dependency Management

### Local Package Dependencies
- `@spin-network/graph-core`: `file:../packages/graph-core`
- Eliminates external path dependencies from original spin-network-app project
- Packages copied directly into repository for self-containment

### Package Manager
- Uses pnpm with lockfile version 9 (generated by pnpm@10.x)
- Package manager specified in frontend/package.json: `pnpm@10.14.0+sha512...`

## Current Issues and Solutions

### 1. Lockfile Synchronization Error
**Issue**: `ERR_PNPM_OUTDATED_LOCKFILE - Cannot install with "frozen-lockfile" because pnpm-lock.yaml is not up to date with package.json`

**Root Cause**: Adding local graph-core dependency without regenerating lockfile

**Solution Strategy**:
```bash
# Option 1: Delete and regenerate lockfile
rm frontend/pnpm-lock.yaml
cd frontend && pnpm install

# Option 2: Update existing lockfile
cd frontend && pnpm install --no-frozen-lockfile

# Option 3: Use specific pnpm version
/Users/deepak/.nvm/versions/node/v23.11.0/bin/pnpm install
```

### 2. Node.js Version Compatibility
**Issue**: Corepack syntax errors with private field operators

**Current Node Version**: Likely v18.x causing compatibility issues
**Required**: Node.js v20+ for modern JavaScript features

**Solution**:
```bash
# Use Node v23.11.0 with compatible pnpm
nvm use v23.11.0
/Users/deepak/.nvm/versions/node/v23.11.0/bin/pnpm install
```

### 3. Backend WebSocket Dependencies
**Issue**: Frontend configured for local backend WebSocket (localhost:8000)
**Impact**: WebSocket connections will fail in production

**Production Configuration Needed**:
- Environment variables for backend API URL
- Conditional WebSocket connection logic
- Fallback for offline mode or mock data

## Deployment Steps

### Phase 1: Fix Build Issues
1. Resolve pnpm lockfile synchronization
2. Update Node.js version if needed
3. Test local build: `cd frontend && pnpm build`
4. Verify dist/ output contains all assets

### Phase 2: Vercel Configuration
1. Ensure Root Directory set to `frontend` in Vercel dashboard
2. Verify vercel.json configuration is valid
3. Set environment variables if needed
4. Deploy and test build process

### Phase 3: Production Testing
1. Verify frontend loads correctly
2. Test application functionality without backend
3. Identify missing API endpoints or WebSocket issues
4. Implement production-ready error handling

## Production Considerations

### Backend Separation
- Backend (Python FastAPI) cannot deploy to Vercel
- Frontend needs to handle backend unavailability gracefully
- Consider deploying backend to Railway, Render, or DigitalOcean

### Environment Configuration
```typescript
// Production config example
const config = {
  apiUrl: process.env.NODE_ENV === 'production' 
    ? 'https://api-domain.com' 
    : 'http://localhost:8000',
  wsUrl: process.env.NODE_ENV === 'production' 
    ? 'wss://api-domain.com/ws' 
    : 'ws://localhost:8000/ws'
}
```

### Static Asset Optimization
- Vite handles code splitting and asset optimization
- Vercel provides CDN distribution automatically
- Large assets (3D models, datasets) may need external CDN

## Success Metrics

### Deployment Success
- [ ] Build completes without errors
- [ ] Application loads on Vercel URL
- [ ] React components render correctly
- [ ] Static assets load properly

### Functionality Verification
- [ ] Random walk simulation initializes
- [ ] Parameter controls work
- [ ] Particle visualizations display
- [ ] Grid layout persists
- [ ] Distribution controls function

### Performance Targets
- [ ] Initial load < 3 seconds
- [ ] First Contentful Paint < 1.5 seconds
- [ ] Lighthouse score > 90
- [ ] Bundle size < 2MB

## Rollback Strategy

If deployment fails:
1. Revert to previous commit
2. Use local development server
3. Debug issues in isolation
4. Re-attempt deployment after fixes

## Future Enhancements

1. **Backend Integration**: Deploy backend separately and configure CORS
2. **CI/CD Pipeline**: Automate testing and deployment
3. **Performance Monitoring**: Add analytics and error tracking
4. **Progressive Enhancement**: Offline functionality and service workers
